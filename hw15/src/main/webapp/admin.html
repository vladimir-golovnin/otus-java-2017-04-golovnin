<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Manage Users</title>
    <script>
        var ws = new WebSocket("ws://localhost:8080/socket");

ws.onopen = function(){
    document.getElementById("status").innerHTML = "<p>Open</p>";
};

ws.onmessage = function (evt){
    var message = JSON.parse(evt.data);
    cleanUsersBoard();
    message.forEach(function(entry){
            printUserData(entry);
        });
};

function cleanUsersBoard(){
    var usersBoard = document.getElementById("usersBoard");
    usersBoard.innerHTML = "<p>Users:</p>";
};

function printUserData(user){
    var usersBoard = document.getElementById("usersBoard");

    var userDiv = document.createElement("div");
    userDiv.setAttribute("id", user.id);
    userDiv.setAttribute("style", "");
    usersBoard.appendChild(userDiv);

    var userName = document.createElement("span");
    userName.innerHTML = user.name + ", " + user.age + " ";
    userDiv.appendChild(userName);

    var removeUser = document.createElement("span");
    removeUser.innerHTML = "<a href=\"#\" OnClick=removeUser(" + user.id + ")>x</a>";
    userDiv.appendChild(removeUser);
};

ws.onclose = function(evt){
    document.getElementById("status").innerHTML = "<p>Connection to server is lost!</p>";
};
ws.onerror = function(error){
    document.getElementById("status").innerHTML = "<p>Error</p>";
};

function addUser(){
    var name = document.getElementById("name").value;
    var age = document.getElementById("age").value;
    if(name != "" && age != ""){
        var userAction = {
            action: 1,
            user: { id: 0, name: name, age: age}
        };
        ws.send(JSON.stringify(userAction));
    }
};

function removeUser(id){
    if(!isNaN(id)){
        var userAction = {
            action: 2,
            user: { id: id, name: "", age: 0}
        };
        ws.send(JSON.stringify(userAction));
    }
};
    </script>
</head>
<body>
<form>
    <p>name:<input type="text" id="name" autocomplete="off"></p>
    <p>age:<input type="text" id="age" autocomplete="off"></p>
    <p><input type="button" value="add" onclick=addUser()></p>
</form>
<div id="usersBoard" style="border: solid 1px black;"></div>
<div id="status"></div>
</body>
</html>
